<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Formulario con Ruleta PD</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      text-align: center;
      padding: 20px;
      background-color: #ffe6f0; /* Fondo rosado claro */
    }
    h2 {
      color: #d63384;
    }
    canvas {
      border: 5px solid #d63384;
      border-radius: 50%;
      margin: 20px 0;
      background-color: #fff0f5;
    }
    #formulario, #ruleta, #mensajeFinal {
      display: none;
    }
    #formulario {
      display: block;
      background-color: #fff0f5;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 0 10px #ffb3d9;
      max-width: 400px;
      margin: 0 auto;
    }
    input, textarea {
      display: block;
      margin: 10px auto;
      width: 80%;
      padding: 10px;
      border: 1px solid #ff99cc;
      border-radius: 10px;
      font-size: 16px;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      margin-top: 10px;
      background-color: #ff69b4;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #ff1493;
    }
    #mensajeFinal h3 {
      color: #c2185b;
    }
  </style>
</head>
<body>

<h2>ðŸ’– Â¡Participa y Gira la Ruleta PD! ðŸ’–</h2>

<div id="formulario">
  <input type="text" id="nombre" placeholder="Nombre" required>
  <input type="tel" id="telefono" placeholder="TelÃ©fono" required>
  <input type="email" id="correo" placeholder="Correo electrÃ³nico" required>
  <textarea id="comentarios" placeholder="Comentarios (opcional)" rows="3"></textarea>
  <button onclick="enviarFormulario()">Enviar y girar ruleta</button>
</div>

<div id="ruleta">
  <canvas id="canvas" width="400" height="400"></canvas><br>
  <button onclick="girarRuleta()">ðŸŽ¯ Girar la ruleta</button>
</div>

<div id="mensajeFinal"></div>

<script>
const premios = ["Camiseta", "Gorra", "15% Descuento", "No ganÃ³", "Mug", "Llaverito"];
const colores = ["#ff99cc", "#ffc0cb", "#f8bbd0", "#ffe6f0", "#f48fb1", "#ec407a"];
let startAngle = 0;
let arc = 2 * Math.PI / premios.length;
let spinAngle = 0;
let spinning = false;
let premioObtenido = "";

const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

function dibujarRuleta() {
  const cx = 200;
  const cy = 200;

  for (let i = 0; i < premios.length; i++) {
    const angle = startAngle + i * arc;
    ctx.beginPath();
    ctx.fillStyle = colores[i % colores.length];
    ctx.moveTo(cx, cy);
    ctx.arc(cx, cy, 200, angle, angle + arc);
    ctx.fill();

    ctx.save();
    ctx.translate(cx, cy);
    ctx.rotate(angle + arc / 2);
    ctx.textAlign = "right";
    ctx.fillStyle = "#fff";
    ctx.font = "bold 16px sans-serif";
    ctx.fillText(premios[i], 180, 10);
    ctx.restore();
  }

  ctx.beginPath();
  ctx.fillStyle = "#000";
  ctx.moveTo(200, 0);
  ctx.lineTo(190, 20);
  ctx.lineTo(210, 20);
  ctx.fill();
}

function girarRuleta() {
  if (spinning) return;
  spinning = true;

  let angle = Math.random() * 360 + 720;
  let current = 0;
  let duration = 3000;
  const start = performance.now();

  function animate(time) {
    let elapsed = time - start;
    if (elapsed < duration) {
      current = easeOut(elapsed, 0, angle, duration);
      startAngle = (current * Math.PI / 180) % (2 * Math.PI);
      ctx.clearRect(0, 0, 400, 400);
      dibujarRuleta();
      requestAnimationFrame(animate);
    } else {
      let finalAngle = (startAngle + arc / 2) % (2 * Math.PI);
      let index = premios.length - Math.floor(finalAngle / arc) - 1;
      if (index < 0) index = premios.length - 1;
      premioObtenido = premios[index];
      mostrarResultado();
    }
  }

  requestAnimationFrame(animate);
}

function easeOut(t, b, c, d) {
  t /= d;
  t--;
  return c*(t*t*t + 1) + b;
}

function enviarFormulario() {
  const nombre = document.getElementById("nombre").value.trim();
  const telefono = document.getElementById("telefono").value.trim();
  const correo = document.getElementById("correo").value.trim();
  const comentarios = document.getElementById("comentarios").value.trim();

  if (!nombre || !telefono || !correo) {
    alert("Por favor, completa todos los campos requeridos.");
    return;
  }

  window.datosUsuario = { nombre, telefono, correo, comentarios };
  document.getElementById("formulario").style.display = "none";
  document.getElementById("ruleta").style.display = "block";
  dibujarRuleta();
}

function mostrarResultado() {
  document.getElementById("ruleta").style.display = "none";
  document.getElementById("mensajeFinal").innerHTML = `<h3>ðŸŽ‰ Â¡Felicidades ${window.datosUsuario.nombre}! Ganaste: <strong>${premioObtenido}</strong></h3>`;

  const datos = {
    ...window.datosUsuario,
    premio: premioObtenido
  };

  fetch("https://script.google.com/macros/s/AKfycbwGeiWwjsWmnT6vzGK-BcFMrd56tokfcZ7LWKvLROghZt_Gy2yQyNCx4R-9FDhqGcvd/exec", {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify(datos)
  })
  .then(res => res.text())
  .then(() => {
    console.log("Datos enviados correctamente a Google Sheets");
  })
  .catch(err => {
    console.error("Error al enviar datos:", err);
    alert("Hubo un problema al guardar tus datos. Intenta de nuevo.");
  });

  spinning = false;
}
</script>

</body>
</html>
