<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Formulario con Ruleta Animada</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
    canvas { border: 5px solid #555; border-radius: 50%; margin: 20px 0; }
    #formulario, #ruleta, #mensajeFinal { display: none; }
    #formulario { display: block; }
    input, textarea { display: block; margin: 10px auto; width: 80%; padding: 10px; }
    button { padding: 10px 20px; font-size: 16px; margin-top: 10px; }
  </style>
</head>
<body>

<h2>Â¡Participa y Gira la Ruleta!</h2>

<div id="formulario">
  <input type="text" id="nombre" placeholder="Nombre" required>
  <input type="tel" id="telefono" placeholder="TelÃ©fono" required>
  <input type="email" id="correo" placeholder="Correo electrÃ³nico" required>
  <textarea id="comentarios" placeholder="Comentarios (opcional)" rows="3"></textarea>
  <button onclick="enviarFormulario()">Enviar y girar ruleta</button>
</div>

<div id="ruleta">
  <canvas id="canvas" width="400" height="400"></canvas><br>
  <button onclick="girarRuleta()">ðŸŽ¯ Girar la ruleta</button>
</div>

<div id="mensajeFinal"></div>

<script>
const premios = ["Camiseta", "Gorra", "15% Descuento", "No ganÃ³", "Mug", "Llaverito"];
const colores = ["#FF6384", "#36A2EB", "#FFCE56", "#4BC0C0", "#9966FF", "#FF9F40"];
let startAngle = 0;
let arc = 2 * Math.PI / premios.length;
let spinAngle = 0;
let spinning = false;
let premioObtenido = "";

const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

function dibujarRuleta() {
  const cx = 200;
  const cy = 200;

  for (let i = 0; i < premios.length; i++) {
    const angle = startAngle + i * arc;
    ctx.beginPath();
    ctx.fillStyle = colores[i % colores.length];
    ctx.moveTo(cx, cy);
    ctx.arc(cx, cy, 200, angle, angle + arc);
    ctx.fill();

    ctx.save();
    ctx.translate(cx, cy);
    ctx.rotate(angle + arc / 2);
    ctx.textAlign = "right";
    ctx.fillStyle = "#fff";
    ctx.font = "bold 16px sans-serif";
    ctx.fillText(premios[i], 180, 10);
    ctx.restore();
  }

  ctx.beginPath();
  ctx.fillStyle = "#000";
  ctx.moveTo(200, 0);
  ctx.lineTo(190, 20);
  ctx.lineTo(210, 20);
  ctx.fill();
}

function girarRuleta() {
  if (spinning) return;
  spinning = true;

  let angle = Math.random() * 360 + 720;
  let current = 0;
  let duration = 3000;
  const start = performance.now();

  function animate(time) {
    let elapsed = time - start;
    if (elapsed < duration) {
      current = easeOut(elapsed, 0, angle, duration);
      startAngle = (current * Math.PI / 180) % (2 * Math.PI);
      ctx.clearRect(0, 0, 400, 400);
      dibujarRuleta();
      requestAnimationFrame(animate);
    } else {
      let finalAngle = (startAngle + arc / 2) % (2 * Math.PI);
      let index = premios.length - Math.floor((finalAngle) / arc) - 1;
      if (index < 0) index = premios.length - 1;
      premioObtenido = premios[index];
      mostrarResultado();
    }
  }

  requestAnimationFrame(animate);
}

function easeOut(t, b, c, d) {
  t /= d;
  t--;
  return c*(t*t*t + 1) + b;
}

function enviarFormulario() {
  const nombre = document.getElementById("nombre").value.trim();
  const telefono = document.getElementById("telefono").value.trim();
  const correo = document.getElementById("correo").value.trim();
  const comentarios = document.getElementById("comentarios").value.trim();

  if (!nombre || !telefono || !correo) {
    alert("Por favor, completa todos los campos requeridos.");
    return;
  }

  window.datosUsuario = { nombre, telefono, correo, comentarios };
  document.getElementById("formulario").style.display = "none";
  document.getElementById("ruleta").style.display = "block";
  dibujarRuleta();
}

function mostrarResultado() {
  document.getElementById("ruleta").style.display = "none";
  document.getElementById("mensajeFinal").innerHTML = `<h3>ðŸŽ‰ Â¡Felicidades! Ganaste: <strong>${premioObtenido}</strong></h3>`;

  const datos = {
    ...window.datosUsuario,
    premio: premioObtenido
  };

  const formData = new FormData();
  formData.append("nombre", datos.nombre);
  formData.append("telefono", datos.telefono);
  formData.append("correo", datos.correo);
  formData.append("comentarios", datos.comentarios);
  formData.append("premio", datos.premio);

  fetch("https://script.google.com/macros/s/AKfycbxoZw4c5ljLaH4cXWO6cP0RVCHfuGduAI0qUPvn1_hx7duuh5hTLN_1ioMk-gFZYP6Ipw/exec", {
    method: "POST",
    body: formData
  })
  .then(res => res.text())
  .then(() => {
    console.log("Datos enviados a Google Sheets");
  })
  .catch(err => {
    console.error("Error al enviar datos:", err);
    alert("Hubo un problema al guardar tus datos. Intenta de nuevo.");
  });

  spinning = false;
}
</script>

</body>
</html>
