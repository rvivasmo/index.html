<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Formulario y Ruleta de Premios PD</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      text-align: center;
      padding: 20px;
      background-color: #fff5f7;
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .container {
      max-width: 500px;
      width: 100%;
    }
    h2 {
      color: #e91e63;
      margin-bottom: 20px;
      text-shadow: 1px 1px 3px rgba(0,0,0,0.1);
    }
    #formulario, #ruletaContainer, #mensajeFinal {
      display: none;
      background-color: white;
      padding: 25px;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    #formulario {
      display: block;
    }
    .form-group {
      margin-bottom: 15px;
      text-align: left;
    }
    label {
      display: block;
      margin-bottom: 5px;
      color: #e91e63;
      font-weight: bold;
    }
    input, textarea {
      width: 100%;
      padding: 12px;
      border: 2px solid #ffc1d5;
      border-radius: 10px;
      font-size: 16px;
      box-sizing: border-box;
      transition: border 0.3s ease;
    }
    input:focus, textarea:focus {
      border-color: #e91e63;
      outline: none;
    }
    button {
      padding: 12px 30px;
      font-size: 18px;
      margin-top: 15px;
      background-color: #e91e63;
      color: white;
      border: none;
      border-radius: 30px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: bold;
      box-shadow: 0 4px 8px rgba(233,30,99,0.3);
    }
    button:hover {
      background-color: #c2185b;
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(233,30,99,0.4);
    }
    button:disabled {
      background-color: #ccc;
      transform: none;
      box-shadow: none;
      cursor: not-allowed;
    }
    #ruletaContainer {
      position: relative;
    }
    #ruleta {
      border: 8px solid #e91e63;
      border-radius: 50%;
      background-color: #fff;
      box-shadow: 0 10px 20px rgba(233,30,99,0.2);
      max-width: 100%;
    }
    #pointer {
      position: absolute;
      top: -15px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 20px solid transparent;
      border-right: 20px solid transparent;
      border-top: 40px solid #e91e63;
      z-index: 10;
      filter: drop-shadow(0 2px 3px rgba(0,0,0,0.2));
    }
    .premio-ganado {
      font-size: 24px;
      color: #e91e63;
      font-weight: bold;
      margin-bottom: 10px;
    }
    .descripcion-premio {
      font-size: 16px;
      color: #666;
    }
    @media (max-width: 500px) {
      #ruleta {
        width: 280px;
        height: 280px;
      }
      h2 {
        font-size: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>üíñ Participa y Gira la Ruleta PD üíñ</h2>

    <!-- Formulario Inicial -->
    <div id="formulario">
      <div class="form-group">
        <label for="nombre">Nombre completo:</label>
        <input type="text" id="nombre" placeholder="Tu nombre" required>
      </div>
      <div class="form-group">
        <label for="telefono">Tel√©fono:</label>
        <input type="tel" id="telefono" placeholder="N√∫mero de contacto" required>
      </div>
      <div class="form-group">
        <label for="correo">Correo electr√≥nico:</label>
        <input type="email" id="correo" placeholder="tu@email.com" required>
      </div>
      <div class="form-group">
        <label for="comentarios">Comentarios (opcional):</label>
        <textarea id="comentarios" rows="3" placeholder="D√©janos tus comentarios..."></textarea>
      </div>
      <button id="btnEnviar" onclick="enviarFormulario()">Enviar y Girar Ruleta</button>
    </div>

    <!-- Ruleta -->
    <div id="ruletaContainer">
      <div id="pointer"></div>
      <canvas id="ruleta"></canvas>
      <button id="btnGirar" onclick="girarRuleta()">üéØ Girar Ruleta</button>
    </div>

    <!-- Mensaje Final -->
    <div id="mensajeFinal">
      <div class="premio-ganado" id="textoPremio"></div>
      <div class="descripcion-premio" id="textoDescripcion"></div>
    </div>
  </div>

  <script>
    // Datos del usuario
    let datosUsuario = {};
    
    // Configuraci√≥n de premios
    const premiosPrincipales = [
      {
        texto: "üß∏ ¬°Ganaste un peluche!",
        descripcion: "Solo redimible en tienda. Aplican t√©rminos y condiciones.",
        color: "#FF9FF3",
        esPremio: true
      },
      {
        texto: "üçΩ ¬°Desayuno sorpresa!",
        descripcion: "Aplican condiciones. V√°lido por 30 d√≠as.",
        color: "#FECA57",
        esPremio: true
      },
      {
        texto: "üéâ Bono de $30.000",
        descripcion: "Para comprar lo que quieras. V√°lido solo en tienda.",
        color: "#FF6B6B",
        esPremio: true
      },
      {
        texto: "üéà Bono de $20.000",
        descripcion: "En regalos y sorpresas. Redenci√≥n en punto f√≠sico.",
        color: "#48DBFB",
        esPremio: true
      },
      {
        texto: "üíù Bono de $10.000",
        descripcion: "Para usar en tu pr√≥xima compra. No acumulable.",
        color: "#1DD1A1",
        esPremio: true
      }
    ];

    const mensajesNoGano = [
      { texto: "üéÄ Te hace falta un mo√±o... ¬°pero casi ganas!", color: "#F9D5E5" },
      { texto: "üéà Ni con globo, ni con mo√±o... vuelve a intentarlo", color: "#E3EAA7" },
      { texto: "üß∏ El peluche te vio... y se escondi√≥ üòÖ", color: "#B2E2E2" },
      { texto: "üíå No ganaste, pero somos tu fan", color: "#FFB347" },
      { texto: "üéÅ Tu regalo viene en camino... pero no hoy üò¨", color: "#A2C8CC" },
      { texto: "üõç Este intento no trae sorpresa, ¬°pero no te rindas!", color: "#FFD3B6" },
      { texto: "üì¶ Regalo extraviado... sigue participando", color: "#D4A5A5" },
      { texto: "üéâ ¬°Uy! Lo envolvimos... pero no te toc√≥", color: "#FF9AA2" },
      { texto: "‚ú® No hay premio, pero s√≠ buena vibra ‚ú®", color: "#FFB7B2" },
      { texto: "üéÇ Este espacio est√° lleno de nada (pero con cari√±o)", color: "#C7CEEA" }
    ];

    // Combinar todos los premios (5 premios grandes + 10 mensajes)
    const todosPremios = [...premiosPrincipales];
    
    // Duplicar premios principales para hacerlos m√°s probables
    todosPremios.push(...premiosPrincipales.slice(0, 3));
    
    // A√±adir mensajes
    todosPremios.push(...mensajesNoGano);

    // Variables de la ruleta
    const ruleta = document.getElementById("ruleta");
    const ctx = ruleta.getContext("2d");
    const btnGirar = document.getElementById("btnGirar");
    const btnEnviar = document.getElementById("btnEnviar");
    const textoPremio = document.getElementById("textoPremio");
    const textoDescripcion = document.getElementById("textoDescripcion");
    
    let anguloActual = 0;
    let girando = false;
    const tama√±oSegmento = (2 * Math.PI) / todosPremios.length;

    // Ajustar tama√±o de la ruleta
    function ajustarRuleta() {
      const esMovil = window.innerWidth <= 500;
      ruleta.width = esMovil ? 300 : 400;
      ruleta.height = esMovil ? 300 : 400;
      dibujarRuleta();
    }

    // Dibujar ruleta
    function dibujarRuleta() {
      const centroX = ruleta.width / 2;
      const centroY = ruleta.height / 2;
      const radio = Math.min(centroX, centroY) - 15;
      
      ctx.clearRect(0, 0, ruleta.width, ruleta.height);
      
      // Dibujar segmentos
      todosPremios.forEach((premio, index) => {
        const anguloInicio = anguloActual + (index * tama√±oSegmento);
        const anguloFin = anguloInicio + tama√±oSegmento;
        
        ctx.beginPath();
        ctx.fillStyle = premio.color;
        ctx.moveTo(centroX, centroY);
        ctx.arc(centroX, centroY, radio, anguloInicio, anguloFin);
        ctx.fill();
        ctx.strokeStyle = "#fff";
        ctx.lineWidth = 1;
        ctx.stroke();
        
        // Texto del premio
        ctx.save();
        ctx.translate(centroX, centroY);
        ctx.rotate(anguloInicio + tama√±oSegmento / 2);
        ctx.textAlign = "right";
        ctx.fillStyle = premio.esPremio ? "#fff" : "#333";
        
        // Ajustar tama√±o de fuente seg√∫n premio
        const fontSize = premio.esPremio ? 
          radio / 8 :  // M√°s grande para premios principales
          radio / 10;  // M√°s peque√±o para mensajes
        
        ctx.font = `bold ${fontSize}px Arial`;
        ctx.fillText(premio.texto, radio - 10, 5);
        ctx.restore();
      });
      
      // Centro de la ruleta
      ctx.beginPath();
      ctx.fillStyle = "#fff";
      ctx.arc(centroX, centroY, 10, 0, 2 * Math.PI);
      ctx.fill();
      ctx.strokeStyle = "#e91e63";
      ctx.lineWidth = 3;
      ctx.stroke();
    }

    // Girar ruleta
    function girarRuleta() {
      if (girando) return;
      
      girando = true;
      btnGirar.disabled = true;
      btnGirar.textContent = "Girando...";
      
      // Configuraci√≥n de la animaci√≥n
      const vueltas = 5;
      const anguloFinal = Math.random() * (2 * Math.PI) + (vueltas * 2 * Math.PI);
      const duracion = 4000;
      const inicio = performance.now();
      
      function animar(tiempo) {
        const progreso = Math.min((tiempo - inicio) / duracion, 1);
        const easing = 1 - Math.pow(1 - progreso, 3); // Ease-out c√∫bico
        
        anguloActual = easing * anguloFinal;
        dibujarRuleta();
        
        if (progreso < 1) {
          requestAnimationFrame(animar);
        } else {
          finalizarGiro();
        }
      }
      
      requestAnimationFrame(animar);
    }

    function finalizarGiro() {
      girando = false;
      btnGirar.disabled = false;
      btnGirar.textContent = "üéØ Girar Ruleta";
      
      // Determinar premio ganador
      const anguloGiro = (anguloActual + tama√±oSegmento / 2) % (2 * Math.PI);
      const indiceGanador = Math.floor(anguloGiro / tama√±oSegmento);
      const premioGanado = todosPremios[indiceGanador];
      
      // Mostrar resultado
      textoPremio.textContent = premioGanado.texto;
      textoDescripcion.textContent = premioGanado.descripcion || "Vuelve a intentarlo en otra oportunidad";
      document.getElementById("ruletaContainer").style.display = "none";
      document.getElementById("mensajeFinal").style.display = "block";
      
      // Enviar datos al servidor
      enviarDatosAlServidor(premioGanado.texto);
    }

    // Enviar formulario
    function enviarFormulario() {
      const nombre = document.getElementById("nombre").value.trim();
      const telefono = document.getElementById("telefono").value.trim();
      const correo = document.getElementById("correo").value.trim();
      const comentarios = document.getElementById("comentarios").value.trim();
      
      // Validaci√≥n b√°sica
      if (!nombre || !telefono || !correo) {
        alert("Por favor completa todos los campos requeridos");
        return;
      }
      
      // Validar email
      if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(correo)) {
        alert("Por favor ingresa un correo electr√≥nico v√°lido");
        return;
      }
      
      // Guardar datos
      datosUsuario = { nombre, telefono, correo, comentarios };
      
      // Mostrar ruleta
      document.getElementById("formulario").style.display = "none";
      document.getElementById("ruletaContainer").style.display = "block";
      ajustarRuleta();
    }

    // Enviar datos al servidor (Google Sheets)
    function enviarDatosAlServidor(premio) {
      const datos = {
        ...datosUsuario,
        premio: premio,
        fecha: new Date().toISOString()
      };
      
      const params = new URLSearchParams();
      for (const key in datos) {
        params.append(key, datos[key]);
      }
      
      fetch("https://script.google.com/macros/s/AKfycbwGeiWwjsWmnT6vzGK-BcFMrd56tokfcZ7LWKvLROghZt_Gy2yQyNCx4R-9FDhqGcvd/exec", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: params
      })
      .then(response => response.json())
      .then(data => {
        if (!data.success) {
          console.error("Error al guardar:", data.error);
        }
      })
      .catch(error => {
        console.error("Error de conexi√≥n:", error);
      });
    }

    // Inicializar
    window.addEventListener('resize', ajustarRuleta);
    ajustarRuleta();
  </script>
</body>
</html>
